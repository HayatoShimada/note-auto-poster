# 古着・ブランド情報自動配信システム 仕様書 (DESIGN.md)

## 1. システム概要
noteの非公式APIを利用し、古着関連のニュースやヴィンテージブランドの情報を、曜日ごとに設定されたテーマに沿って定期的に自動投稿（または下書き保存）するシステム。

## 2. 主な要件・機能
- **コンテンツ自動生成機能**: 曜日ごとのテーマ設定に基づき、古着やブランドに関する記事本文（Markdown形式）を生成・整形する。
- **スケジュール配信（定期実行）**: 定められた曜日・時刻にスクリプトを自動的に起動させる。
- **note API連携機能**: 
  - 記事の作成・下書き保存 (`POST /api/v1/text_notes`)
  - 記事の更新 (`PUT /api/v1/text_notes/{id}`)
  - 画像のアップロード (`POST /api/v1/upload_image`)
- **エラー通知機能**: 非公式APIの仕様変更やCookie失効などで投稿に失敗した場合の通知の仕組み。
- 内容がかぶらないように

## 3. 曜日ごとの配信テーマ設計（案）
ターゲット層（古着好き・ファッション感度の高いユーザー）に合わせ、毎日異なる切り口で有益な情報を配信する。

- **月曜日**: 今週の古着トレンド予報・注目キーワード
- **火曜日**: 名作ヴィンテージ・人気ブランドの歴史アーカイブ解説
- **水曜日**: 日本の古着屋スタッフやインフルエンサーを取り入れた着こなしアイデア
- **木曜日**: 海外の古着屋スタッフやインフルエンサーを取り入れた着こなしアイデア
- **土曜日**: 特定ジャンル（ミリタリー、ワーク、ユーロヴィンテージ等）の深掘り特集
- **日曜日**: 今週のおさらい・1週間まとめショートコラム

## 4. システムアーキテクチャ構成
シンプルな運用と低コスト化を目的とし、サーバーレス基盤を活用する。

- **実行基盤**: **GitHub Actions** 
  - cronトリガー (`schedule`) を利用して特定日時にPythonスクリプトを自動実行する。
- **バックエンド言語**: **Python 3.x**
  - `requests` ライブラリを用いたAPI連携の実装が容易なため。
- **コンテンツソース（データ収集）**:
  - LLM (OpenAI APIやAnthropic API等) による自動生成
  - RSSフィード/スクレイピングによる古着系メディアのニュース取得
- **認証情報管理**: **GitHub Secrets**
  - noteのセッションCookie文字列などを環境変数として安全に管理する。

## 5. note 非公式APIの活用仕様
提供された参考記事の実装に基づき、以下のエンドポイントを活用する。

| 操作             | HTTPメソッド | エンドポイント                            | 備考                                                                          |
| ---------------- | ------------ | ----------------------------------------- | ----------------------------------------------------------------------------- |
| 記事作成         | `POST`       | `https://note.com/api/v1/text_notes`      | MarkdownからHTMLへの変換を挟んで送信 (`body`, `name`). 戻り値で記事ID等を取得 |
| 画像アップロード | `POST`       | `https://note.com/api/v1/upload_image`    | 記事のサムネイルや文中の画像ファイルを送信                                    |
| 記事更新         | `PUT`        | `https://note.com/api/v1/text_notes/{id}` | すでに作成した下書き記事の修正を行う際に利用                                  |

## 6. 実装ロードマップ

### フェーズ1: note API 基礎基盤の構築
- PythonにてAPIリクエストを行う共通関数（`create_article`, `upload_image`等）を実装。
- ローカル環境にて、自身のnoteアカウントへ手動で下書き記事が作成できるか検証する。

### フェーズ2: コンテンツ生成ロジックの実装
- 実行された日付・曜日を判定する処理を実装。
- 曜日に対応したテーマ・フォーマットを呼び出し、Markdown形式で出力する仕組みを構築。
- LLM APIを用いたテキスト生成、または外部RSS等からのデータパースを行う。

### フェーズ3: 定期自動実行とデプロイ
- GitHubリポジトリにソースコードをプッシュ。
- `.github/workflows/post_article.yml` を作成し、cronスケジュールを設定。
- GitHub Secretsに必要なトークン（note用Cookie, LLM用APIキー等）を設定。

## 7. 運用上の注意点・制限事項
- **非公式APIの使用**: 短期間での頻繁なリクエストは避け、APIコール間に適宜 `sleep` を組み込みサーバー負荷を軽減すること。仕様変更により突然動作しなくなるリスクがある。
- **Cookieの有効期限**: セッションCookieは一定期間経過や強制ログアウトで無効になる場合があるため、定期的な再取得・Secrets更新の運用フローが必要。
- **ハルシネーション対策**: LLMで生成する場合は、完全に自動公開する設定にせず「下書き保存」までを自動化し、最終確認と公開作業は人間が行うフローを推奨する。

## TechStak GeminiApiを利用すること
